# =============================================================================
# SPhoto Free Tier Instance (No Machine Learning)
# =============================================================================
# URL: free.sphoto.arturf.ch
# Features: 5GB storage, no ML features
# =============================================================================

name: sphoto-free

services:
  server:
    image: ghcr.io/immich-app/immich-server:${IMMICH_VERSION:-release}
    container_name: sphoto-free-server
    environment:
      - DB_URL=postgresql://sphoto:${DB_PASSWORD}@db:5432/sphoto
      - REDIS_HOSTNAME=redis
      # No ML - leave empty to disable
      - MACHINE_LEARNING_URL=
    volumes:
      - ${UPLOAD_LOCATION:-./uploads}:/usr/src/app/upload
    depends_on:
      - db
      - redis
    restart: unless-stopped
    networks:
      - sphoto-net
      - internal
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.sphoto-free.rule=Host(`free.${DOMAIN}`)"
      - "traefik.http.routers.sphoto-free.entrypoints=websecure"
      - "traefik.http.routers.sphoto-free.tls.certresolver=le"
      - "traefik.http.services.sphoto-free.loadbalancer.server.port=2283"

  db:
    image: ghcr.io/immich-app/postgres:16-vectorchord0.4.3-pgvectors0.2.0
    container_name: sphoto-free-db
    environment:
      - POSTGRES_PASSWORD=${DB_PASSWORD}
      - POSTGRES_USER=sphoto
      - POSTGRES_DB=sphoto
    volumes:
      - ./db:/var/lib/postgresql/data
    restart: unless-stopped
    networks:
      - internal

  redis:
    image: valkey/valkey:9
    container_name: sphoto-free-redis
    restart: unless-stopped
    networks:
      - internal

networks:
  sphoto-net:
    external: true
  internal:
